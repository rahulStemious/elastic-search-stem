name: firestore-elasticsearch-sync
version: 1.4.0
specVersion: v1beta
license: Apache-2.0
displayName: Firestore → Elasticsearch Sync (Single Collection)
description: Automatically sync Firestore documents to Elasticsearch index with custom field mapping.

resources:
  - name: ${param:FUNCTION_ID}-firestore-to-elasticsearch
    type: firebaseextensions.v1beta.function
    properties:
      location: ${param:LOCATION}
      entryPoint: sync_firestore_to_elasticsearch
      eventTrigger:
        eventType: providers/cloud.firestore/eventTypes/document.write
        resource: projects/${PROJECT_ID}/databases/(default)/documents/${param:FIRESTORE_COLLECTION_PATH}/{docId}

params:
  - param: FUNCTION_ID
    label: Unique Function ID
    description: "Used to uniquely identify this deployment (prevents overwriting)."
    example: "users"
    required: true

  - param: FIRESTORE_COLLECTION_PATH
    label: Firestore Collection Path
    description: "Path of the Firestore collection to sync."
    example: "users"
    required: true

  - param: ELASTIC_INDEX
    label: Elasticsearch Index Name
    description: "Target index in Elasticsearch where documents will be stored."
    example: "search-users"
    required: true

  - param: ELASTIC_API_KEY
    label: Elasticsearch API Key
    description: "API Key for Elasticsearch access."
    secret: true
    required: true

  - param: ELASTIC_URL
    label: Elasticsearch URL
    description: "Full URL of your Elasticsearch endpoint (e.g., https://your-es-cluster.es.amazonaws.com)."
    example: "https://<id>.asia-south1.gcp.elastic-cloud.com:443"
    required: true


  - param: INDEXED_FIELDS
    label: Indexed Fields (Firestore → Elasticsearch mapping)
    description: "Comma separated list of fields to index. Use '::' to rename fields (e.g., firstName::first_name,lastName::last_name,email)."
    example: "firstName::first_name,lastName::last_name,email"
    required: true

  - param: LOCATION
    label: Cloud Function Region
    default: asia-south1
