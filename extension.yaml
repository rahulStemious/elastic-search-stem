name: firestore-elasticsearch-sync
version: 1.4.0
specVersion: v1beta
license: Apache-2.0
displayName: Firestore → Elasticsearch Sync (Single Collection)
description: Automatically sync Firestore documents to Elasticsearch index with custom field mapping.

resources:
  - name: sync_firestore_to_elasticsearch
    type: firebaseextensions.v1beta.function
    description: "Sync Firestore documents (create/update/delete) to an Elasticsearch index."
    properties:
      location: ${param:LOCATION}
      eventTrigger:
            # Event Type: The Firestore event for Create, Update, or Delete (i.e., onWrite in your Node.js code)
            eventType: providers/cloud.firestore/eventTypes/document.write
            
            # Resource: The path to the Firestore documents to watch.
            # It uses the user-defined parameter value and appends the wildcard {docId}.
            resource: projects/${PROJECT_ID}/databases/(default)/documents/${param:FIRESTORE_COLLECTION_PATH}/{docId}

params:
  - param: FIRESTORE_COLLECTION_PATH
    label: Firestore Collection Path
    description: "Path of the Firestore collection to sync."
    example: "users"
    required: true

  - param: ELASTIC_INDEX
    label: Elasticsearch Index Name
    description: "Target index in Elasticsearch where documents will be stored."
    example: "search-users"
    required: true

  - param: ELASTIC_API_KEY
    label: Elasticsearch API Key
    description: "API Key for Elasticsearch access."
    secret: true
    required: true

  - param: INDEXED_FIELDS
    label: Indexed Fields (Firestore → Elasticsearch mapping)
    description: "Comma separated list of fields to index. Use '::' to rename fields (e.g., firstName::first_name,lastName::last_name,email)."
    example: "firstName::first_name,lastName::last_name,email"
    required: true

  - param: LOCATION
    label: Cloud Function Region
    default: asia-south1
